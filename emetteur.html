<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Émetteur Sync</title>
<style>
.bold { font-weight:bold; color:red; }
</style>
</head>
<body>

<h2>Émetteur avec Synchronisation</h2>

<input id="texteInput" placeholder="Tape ton texte">
<button onclick="envoyer()">Envoyer</button>

<p id="texteAffiche"></p>
<p id="binaireAffiche"></p>

<script>

const BIT_DURATION = 0.2;
const FREQ0 = 1200;
const FREQ1 = 2200;
const START = 3000;
const END = 3500;

const PREAMBLE = "11110000";

let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function textToBinary(text){
    return text.split('').map(c =>
        c.charCodeAt(0).toString(2).padStart(8,'0')
    );
}

function tone(freq,dur,time){
    const osc = audioCtx.createOscillator();
    osc.frequency.value = freq;
    osc.connect(audioCtx.destination);
    osc.start(time);
    osc.stop(time+dur);
}

async function envoyer(){

    const texte = document.getElementById("texteInput").value;
    const binaries = textToBinary(texte);

    let time = audioCtx.currentTime;

    tone(START,1,time);
    time+=1;

    for(let i=0;i<binaries.length;i++){

        document.getElementById("texteAffiche").innerHTML =
            texte.split('').map((l,index)=>
                index===i ? `<span class="bold">${l}</span>` : l
            ).join('');

        document.getElementById("binaireAffiche").innerText =
            PREAMBLE + " " + binaries[i];

        let fullByte = PREAMBLE + binaries[i];

        for(let bit of fullByte){
            tone(bit==="0"?FREQ0:FREQ1,BIT_DURATION,time);
            time+=BIT_DURATION;
        }
    }

    tone(END,1,time);
}

</script>
</body>
</html>
