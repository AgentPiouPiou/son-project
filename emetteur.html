<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Émetteur Stable</title>
</head>
<body>

<h2>Émetteur Stable</h2>

<input id="texte" placeholder="Tape ton texte">
<button onclick="envoyer()">Envoyer</button>

<script>

const BIT_DURATION = 0.2;
const FREQ_0 = 1200;
const FREQ_1 = 2200;
const FREQ_START = 3000;
const FREQ_END = 3500;

function textToBinary(text){
    return text.split('')
        .map(c => c.charCodeAt(0).toString(2).padStart(8,'0'))
        .join('');
}

async function envoyer(){

    const texte = document.getElementById("texte").value;
    const binary = textToBinary(texte);

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    let time = audioCtx.currentTime;

    function playTone(freq, duration){
        const osc = audioCtx.createOscillator();
        osc.frequency.value = freq;
        osc.connect(audioCtx.destination);
        osc.start(time);
        osc.stop(time + duration);
        time += duration;
    }

    // START SIGNAL
    playTone(FREQ_START, 0.5);

    // DATA
    for(let bit of binary){
        playTone(bit === "1" ? FREQ_1 : FREQ_0, BIT_DURATION);
    }

    // END SIGNAL
    playTone(FREQ_END, 0.5);
}

</script>
</body>
</html>
