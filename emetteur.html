<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ã‰metteur dÃ©cimal</title>

<style>
body{
  font-family:Arial;
  max-width:800px;
  margin:auto;
}

textarea{
  width:100%;
  min-height:100px;
}

canvas{
  width:100%;
  height:200px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<h1>ðŸ”Š Ã‰metteur dÃ©cimal</h1>

<textarea id="texte" placeholder="Entrez des chiffres"></textarea>

<br><br>

<button onclick="send()">Envoyer</button>

<h3>Visualisation Ã©mission</h3>
<canvas id="vizTx"></canvas>

<p id="etat"></p>

<script>

const audioCtx=new AudioContext();

const SYMBOL_FREQS=[500,700,900,1100,1300,1500,1700,1900,2100,2300];

const INIT_FREQ=300;

const SYMBOL_DURATION=0.05;
const GAP=0.01;

function tone(freq,start,dur,gain=0.2){

  const osc=audioCtx.createOscillator();
  const g=audioCtx.createGain();

  osc.frequency.value=freq;
  osc.type="sine";

  g.gain.setValueAtTime(0.00001,start);
  g.gain.linearRampToValueAtTime(gain,start+0.005);
  g.gain.linearRampToValueAtTime(0.00001,start+dur);

  osc.connect(g);
  g.connect(audioCtx.destination);

  osc.start(start);
  osc.stop(start+dur);
}

function drawEmitter(freq){

  const canvas=document.getElementById("vizTx");
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="white";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="black";
  ctx.fillText("Emission : "+freq+" Hz",10,20);
}

async function send(){

  await audioCtx.resume();

  const text=document.getElementById("texte").value;

  const digits=text.split("").filter(c=>!isNaN(c));

  let t=audioCtx.currentTime+0.1;

  tone(INIT_FREQ,t,0.8,0.25);
  t+=1.0;

  for(const d of digits){

    const freq=SYMBOL_FREQS[parseInt(d)];

    tone(freq,t,SYMBOL_DURATION,0.2);

    drawEmitter(freq);

    t+=SYMBOL_DURATION+GAP;
  }

  document.getElementById("etat").textContent="Transmission lancÃ©e";
}

</script>
</body>
</html>
